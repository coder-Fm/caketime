<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Alexa Skill Codes</title>
  </head>
  <body>
    <h1 id="title">Cake Time Skill</h1>
    <hr>

    <h2 style="color: blue;">Code 1</h2>
    <h2>Adding a new dependency to requirements.txt</h2>
    <textarea id="python1" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
    width: 75%; height: 40px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
    ask-sdk-s3-persistence-adapter</textarea>

    <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
      <button onclick="copyThis1()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 1</button>
    </div>

    <br/><br/>

    <h2 style="color: blue;">Code 2</h2>
    <h2>Using Amazon S3 to save and read data</h2>
    <textarea id="python2" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
    width: 75%; height: 100px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
    import os
    from ask_sdk_s3.adapter import S3Adapter
    s3_adapter = S3Adapter(bucket_name=os.environ["S3_PERSISTENCE_BUCKET"])</textarea>

    <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
      <button onclick="copyThis2()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 2</button>
    </div>

    <br/><br/>

    <h2 style="color: blue;">Code 3</h2>
    <h2>Using Amazon S3 to save and read data</h2>
    <textarea id="python3" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
    width: 75%; height: 40px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
    from ask_sdk_core.skill_builder import CustomSkillBuilder</textarea>

    <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
      <button onclick="copyThis3()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 3</button>
    </div>

    <br/><br/>

    <h2 style="color: blue;">Code 4</h2>
    <h2>Using Amazon S3 to save and read data</h2>
    <textarea id="python4" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
    width: 75%; height: 40px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
    sb = CustomSkillBuilder(persistence_adapter=s3_adapter)</textarea>

    <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
      <button onclick="copyThis4()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 4</button>
    </div>

    <br/><br/>

    <h2 style="color: blue;">Code 5</h2>
    <h2>Saving Data</h2>
    <textarea id="python5" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
    width: 75%; height: 40px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
    attributes_manager = handler_input.attributes_manager</textarea>

    <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
      <button onclick="copyThis5()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 5</button>
    </div>

    <br/><br/>

    <h2 style="color: blue;">Code 6</h2>
    <h2>Saving Data</h2>
    <textarea id="python6" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
    width: 75%; height: 140px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
    birthday_attributes = {
            "year": year,
            "month": month,
            "day": day
        }</textarea>

    <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
      <button onclick="copyThis6()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 6</button>
    </div>

    <br/><br/>

    <h2 style="color: blue;">Code 7</h2>
    <h2>Saving Data</h2>
    <textarea id="python7" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
    width: 75%; height: 80px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
    attributes_manager.persistent_attributes = birthday_attributes
    attributes_manager.save_persistent_attributes()</textarea>

    <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
      <button onclick="copyThis7()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 7</button>
    </div>

    <br/><br/>

    <h2 style="color: blue;">Code 8</h2>
    <h2>Reading stored data (User's Birthday)</h2>
    <textarea id="python8" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
    width: 75%; height: 200px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
    class HasBirthdayLaunchRequestHandler(AbstractRequestHandler):
        """Handler for launch after they have set their birthday"""

        def can_handle(self, handler_input):
            # extract persistent attributes and check if they are all present
            attr = handler_input.attributes_manager.persistent_attributes
            attributes_are_present = ("year" in attr and "month" in attr and "day" in attr)

            return attributes_are_present and ask_utils.is_request_type("LaunchRequest")(handler_input)

        def handle(self, handler_input):
            attr = handler_input.attributes_manager.persistent_attributes
            year = int(attr['year'])
            month = attr['month'] # month is a string, and we need to convert it to a month index later
            day = int(attr['day'])

            # TODO:: Use the settings API to get current date and then compute how many days until user's birthday
            # TODO:: Say happy birthday on the user's birthday

            speak_output = "Welcome back it looks like there are X more days until your y-th birthday."
            handler_input.response_builder.speak(speak_output)

            return handler_input.response_builder.response</textarea>

      <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
        <button onclick="copyThis8()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 8</button>
      </div>

      <br/><br/>

      <h2 style="color: blue;">Code 9</h2>
      <h2>Reading stored data (User's Birthday)</h2>
      <textarea id="python9" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
      width: 75%; height: 40px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
      sb.add_request_handler(HasBirthdayLaunchRequestHandler())</textarea>

      <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
        <button onclick="copyThis9()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 9</button>
      </div>

      <br/><br/>

      <h2 style="color: blue;">Code 10</h2>
      <h2>Using the Alexa Settings API</h2>
      <textarea id="python10" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
      width: 75%; height: 185px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
      # get device id
        sys_object = handler_input.request_envelope.context.system
        device_id = sys_object.device.device_id

        # get Alexa Settings API information
        api_endpoint = sys_object.api_endpoint
        api_access_token = sys_object.api_access_token</textarea>

      <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
        <button onclick="copyThis10()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 10</button>
      </div>

      <br/><br/>
      <h2 style="color: blue;">Code 11</h2>
      <h2>Using the Alexa Settings API to retrieve the user time zone</h2>
      <textarea id="python11" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
      width: 75%; height: 185px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
      # construct systems api timezone url
        url = '{api_endpoint}/v2/devices/{device_id}/settings/System.timeZone'.format(api_endpoint=api_endpoint, device_id=device_id)
        headers = {'Authorization': 'Bearer ' + api_access_token}

        userTimeZone = ""
        try:
            r = requests.get(url, headers=headers)
            res = r.json()
            logger.info("Device API result: {}".format(str(res)))
            userTimeZone = res
        except Exception:
            handler_input.response_builder.speak("There was a problem connecting to the service")
            return handler_input.response_builder.response</textarea>

      <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
        <button onclick="copyThis11()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 11</button>
      </div>

      <br/><br/>
      <h2 style="color: blue;">Code 12</h2>
      <h2>Retrieve the current date</h2>
      <textarea id="python12" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
      width: 75%; height: 120px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
      import requests
      import calendar
      from datetime import datetime
      from pytz import timezone</textarea>

      <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
        <button onclick="copyThis12()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 12</button>
      </div>

      <br/><br/>

      <h2 style="color: blue;">Code 13</h2>
      <h2>Retrieve the current date</h2>
      <textarea id="python13" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
      width: 75%; height: 60px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
      # getting the current date with the time
        now_time = datetime.now(timezone(userTimeZone))</textarea>

      <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
        <button onclick="copyThis13()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 13</button>
      </div>

      <br/><br/>

      <h2 style="color: blue;">Code 14</h2>
      <h2>Extracting the month, day, and year</h2>
      <textarea id="python14" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
      width: 75%; height: 80px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
      # Removing the time from the date because it affects our difference calculation
        now_date = datetime(now_time.year, now_time.month, now_time.day)
        current_year = now_time.year</textarea>

      <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
        <button onclick="copyThis14()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 14</button>
      </div>

      <br/><br/>

      <h2 style="color: blue;">Code 15</h2>
      <h2>Determining the user's next birthday</h2>
      <textarea id="python15" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
      width: 75%; height: 80px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
      # getting the next birthday
      month_as_index = list(calendar.month_abbr).index(month[:3].title())
      next_birthday = datetime(current_year, month_as_index, day)</textarea>

      <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
        <button onclick="copyThis15()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 15</button>
      </div>

      <br/><br/>

      <h2 style="color: blue;">Code 16</h2>
      <h2>Determining the user's next birthday</h2>
      <textarea id="python16" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
      width: 75%; height: 80px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
      year = int(attr['year'])
      month = attr['month'] # month is a string, and we need to convert it to a month index later
      day = int(attr['day'])</textarea>

      <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
        <button onclick="copyThis16()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 16</button>
      </div>

      <br/><br/>

      <h2 style="color: blue;">Code 17</h2>
      <h2>Computing user's next birthday</h2>
      <textarea id="python17" type="text/javascript" style="border-style: solid; border-width: 1px 1px 1px 20px; border-color: #4072a1;
      width: 75%; height: 200px; line-height: 1.5; resize: none; font-size: 18px;" readonly>
      # check if we need to adjust bday by one year
     if now_date > next_birthday:
         next_birthday = datetime(
             current_year + 1,
             month_as_index,
             day
         )
         current_year += 1
     # setting the default speak_output to Happy xth Birthday!!
     # Alexa will automatically correct the ordinal for you.
     # no need to worry about when to use st, th, rd
     speak_output = "Happy {}th birthday!".format(str(current_year - year))
     if now_date != next_birthday:
         diff_days = abs((now_date - next_birthday).days)
         speak_output = "Welcome back. It looks like there are \
                         {days} days until your {birthday_num}th\
                         birthday".format(
                             days=diff_days,
                             birthday_num=(current_year-year)
                         )</textarea>

      <div style="font-size: 16px; font-family: comic sans ms; color: blue;">
        <button onclick="copyThis17()" style="width: 150px; height: 40px; font-size: 16px;">Copy Code 17</button>
      </div>

      <br/><br/>

  </body>
  <script>
    function copyThis1() {
      const python1 = document.getElementById("python1");
      python1.select();
      python1.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 1 copied");
    }
    function copyThis2() {
      const python2 = document.getElementById("python2");
      python2.select();
      python2.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 2 copied");
    }
    function copyThis3() {
      const python3 = document.getElementById("python3");
      python3.select();
      python3.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 3 copied");
    }
    function copyThis4() {
      const python4 = document.getElementById("python4");
      python4.select();
      python4.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 4 copied");
    }
    function copyThis5() {
      const python5 = document.getElementById("python5");
      python5.select();
      python5.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 5 copied");
    }
    function copyThis6() {
      const python6 = document.getElementById("python6");
      python6.select();
      python6.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 6 copied");
    }
    function copyThis7() {
      const python7 = document.getElementById("python7");
      python7.select();
      python7.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 7 copied");
    }
    function copyThis8() {
      const python8 = document.getElementById("python8");
      python8.select();
      python8.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 8 copied");
    }
    function copyThis9() {
      const python9 = document.getElementById("python9");
      python9.select();
      python9.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 9 copied");
    }
    function copyThis10() {
      const python10 = document.getElementById("python10");
      python10.select();
      python10.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 10 copied");
    }
    function copyThis11() {
      const python11 = document.getElementById("python11");
      python11.select();
      python11.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 11 copied");
    }
    function copyThis12() {
      const python12 = document.getElementById("python12");
      python12.select();
      python12.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 12 copied");
    }
    function copyThis13() {
      const python13 = document.getElementById("python13");
      python13.select();
      python13.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 13 copied");
    }
    function copyThis14() {
      const python14 = document.getElementById("python14");
      python14.select();
      python14.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 14 copied");
    }
    function copyThis15() {
      const python15 = document.getElementById("python15");
      python15.select();
      python15.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 15 copied");
    }
    function copyThis16() {
      const python16 = document.getElementById("python16");
      python16.select();
      python16.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 16 copied");
    }
    function copyThis17() {
      const python17 = document.getElementById("python17");
      python17.select();
      python17.setSelectionRange(0, 99999)
      document.execCommand("copy");
      alert("Code 17 copied");
    }
  </script>
</html>
